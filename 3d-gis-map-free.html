<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D GIS åœ°å›¾ç³»ç»Ÿ - å…è´¹ç‰ˆ</title>
    
    <!-- EasyUI CSS -->
    <link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/themes/icon.css">
    
    <!-- Cesium CSS -->
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.98/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    
    <!-- jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- EasyUI JS -->
    <script type="text/javascript" src="https://www.jeasyui.com/easyui/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="https://www.jeasyui.com/easyui/locale/easyui-lang-zh_CN.js"></script>
    
    <!-- Cesium JS -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.98/Build/Cesium/Cesium.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }
        
        #mapContainer {
            width: 100%;
            height: 100vh;
            position: relative;
        }
        
        #cesiumContainer {
            width: 100%;
            height: 100%;
        }
        
        .toolbar-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(42, 42, 42, 0.9);
            border-radius: 5px;
            padding: 10px;
        }
        
        .info-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 320px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 5px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .building-label {
            background: rgba(0, 123, 255, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .road-label {
            background: rgba(40, 167, 69, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
        }
        
        .marker-info {
            margin-bottom: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            border-radius: 3px;
        }
        
        .route-info {
            margin-bottom: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            border-radius: 3px;
        }
        
        .free-notice {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="mapContainer">
        <!-- 3D åœ°å›¾å®¹å™¨ -->
        <div id="cesiumContainer"></div>
        
        <!-- å·¥å…·æ  -->
        <div class="toolbar-panel">
            <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-add'" onclick="addMarker()">æ·»åŠ æ ‡ç‚¹</a>
            <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-edit'" onclick="drawRoute()">ç»˜åˆ¶è·¯çº¿</a>
            <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-search'" onclick="toggleBuildings()">å»ºç­‘æ˜¾ç¤º</a>
            <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-tip'" onclick="toggleRoads()">é“è·¯æ˜¾ç¤º</a>
            <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-clear'" onclick="clearAll()">æ¸…é™¤æ‰€æœ‰</a>
            <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-help'" onclick="showHelp()">å¸®åŠ©</a>
        </div>
        
        <!-- ä¿¡æ¯é¢æ¿ -->
        <div class="info-panel">
            <div class="free-notice">
                <strong>âœ… å®Œå…¨å…è´¹ç‰ˆæœ¬</strong><br>
                ä½¿ç”¨å¼€æºåœ°å›¾æ•°æ®ï¼Œæ— éœ€ä»˜è´¹æœåŠ¡
            </div>
            <h3 style="margin-top: 0;">åœ°å›¾ä¿¡æ¯</h3>
            <div id="infoContent">
                <p>æ¬¢è¿ä½¿ç”¨ 3D GIS åœ°å›¾ç³»ç»Ÿï¼ˆå…è´¹ç‰ˆï¼‰</p>
                <p><strong>æ•°æ®æºè¯´æ˜ï¼š</strong></p>
                <ul>
                    <li>åœ°å›¾ï¼šOpenStreetMapï¼ˆå…è´¹ï¼‰</li>
                    <li>åœ°å½¢ï¼šæœ¬åœ°ç”Ÿæˆï¼ˆå…è´¹ï¼‰</li>
                    <li>3Då»ºç­‘ï¼šç¨‹åºç”Ÿæˆï¼ˆå…è´¹ï¼‰</li>
                </ul>
                <p><strong>åŠŸèƒ½è¯´æ˜ï¼š</strong></p>
                <ul>
                    <li>ç‚¹å‡»"æ·»åŠ æ ‡ç‚¹"ååœ¨åœ°å›¾ä¸Šç‚¹å‡»æ·»åŠ æ ‡è®°</li>
                    <li>ç‚¹å‡»"ç»˜åˆ¶è·¯çº¿"ååœ¨åœ°å›¾ä¸Šç‚¹å‡»å¤šä¸ªç‚¹ç»˜åˆ¶è·¯å¾„</li>
                    <li>åˆ‡æ¢å»ºç­‘å’Œé“è·¯åç§°æ˜¾ç¤º</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- æ ‡ç‚¹ä¿¡æ¯å¯¹è¯æ¡† -->
    <div id="markerDialog" class="easyui-dialog" title="æ ‡ç‚¹ä¿¡æ¯" style="width:400px;height:300px;" 
         data-options="iconCls:'icon-add',resizable:true,modal:true,closed:true">
        <form id="markerForm" style="padding:20px;">
            <div style="margin-bottom:10px">
                <label>æ ‡ç‚¹åç§°:</label>
                <input class="easyui-textbox" name="name" style="width:100%" data-options="required:true">
            </div>
            <div style="margin-bottom:10px">
                <label>æè¿°ä¿¡æ¯:</label>
                <input class="easyui-textbox" name="description" style="width:100%" data-options="multiline:true,height:60">
            </div>
            <div style="margin-bottom:10px">
                <label>æ ‡è®°ç±»å‹:</label>
                <select class="easyui-combobox" name="type" style="width:100%">
                    <option value="building">å»ºç­‘</option>
                    <option value="landmark">åœ°æ ‡</option>
                    <option value="facility">è®¾æ–½</option>
                    <option value="custom">è‡ªå®šä¹‰</option>
                </select>
            </div>
            <div style="text-align:center;padding:10px">
                <a href="#" class="easyui-linkbutton" onclick="saveMarker()">ä¿å­˜</a>
                <a href="#" class="easyui-linkbutton" onclick="$('#markerDialog').dialog('close')">å–æ¶ˆ</a>
            </div>
        </form>
    </div>

    <!-- å¸®åŠ©å¯¹è¯æ¡† -->
    <div id="helpDialog" class="easyui-dialog" title="ä½¿ç”¨å¸®åŠ©" style="width:500px;height:400px;" 
         data-options="iconCls:'icon-help',resizable:true,modal:true,closed:true">
        <div style="padding:20px;">
            <h3>Cesium æ”¶è´¹è¯´æ˜</h3>
            <div style="background:#f8f9fa;padding:15px;border-radius:5px;margin-bottom:15px;">
                <h4>ğŸ†“ å…è´¹éƒ¨åˆ†</h4>
                <ul>
                    <li>CesiumJS å¼€æºåº“ï¼ˆApache 2.0 åè®®ï¼‰</li>
                    <li>åŸºç¡€ 3D åœ°çƒåŠŸèƒ½</li>
                    <li>æœ¬åœ°éƒ¨ç½²å’Œç¦»çº¿ä½¿ç”¨</li>
                    <li>OpenStreetMap åœ°å›¾æ•°æ®</li>
                </ul>
                
                <h4>ğŸ’° æ”¶è´¹éƒ¨åˆ†</h4>
                <ul>
                    <li>Cesium Ion äº‘æœåŠ¡</li>
                    <li>é«˜ç²¾åº¦åœ°å½¢æ•°æ®</li>
                    <li>å•†ä¸šå«æ˜Ÿå½±åƒ</li>
                    <li>3D å»ºç­‘ç‰©æ•°æ®é›†</li>
                </ul>
            </div>
            
            <h3>æœ¬ç‰ˆæœ¬ç‰¹ç‚¹</h3>
            <ul>
                <li>âœ… å®Œå…¨å…è´¹ï¼Œæ— éœ€æ³¨å†Œ</li>
                <li>âœ… ä½¿ç”¨ OpenStreetMap æ•°æ®</li>
                <li>âœ… æœ¬åœ°ç”Ÿæˆåœ°å½¢å’Œå»ºç­‘</li>
                <li>âœ… æ”¯æŒç¦»çº¿ä½¿ç”¨</li>
                <li>âœ… æ— è®¿é—®é™åˆ¶</li>
            </ul>
            
            <div style="text-align:center;padding:10px">
                <a href="#" class="easyui-linkbutton" onclick="$('#helpDialog').dialog('close')">å…³é—­</a>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let viewer;
        let isAddingMarker = false;
        let isDrawingRoute = false;
        let currentRoute = [];
        let markers = [];
        let routes = [];
        let buildingsVisible = true;
        let roadsVisible = true;
        let pendingMarkerPosition = null;

        // ä¸ä½¿ç”¨ Cesium Ionï¼Œå®Œå…¨å…è´¹
        // Cesium.Ion.defaultAccessToken = ''; // ç§»é™¤è¿™è¡Œ

        $(document).ready(function() {
            initializeMap();
            setupEventHandlers();
        });

        function initializeMap() {
            viewer = new Cesium.Viewer('cesiumContainer', {
                // ä½¿ç”¨å…è´¹çš„ OpenStreetMap æ•°æ®æº
                imageryProvider: new Cesium.OpenStreetMapImageryProvider({
                    url: 'https://a.tile.openstreetmap.org/'
                }),
                // ä½¿ç”¨åŸºç¡€åœ°å½¢ï¼ˆå…è´¹ï¼‰
                terrainProvider: new Cesium.EllipsoidTerrainProvider(),
                baseLayerPicker: false,
                geocoder: false,
                homeButton: false,
                sceneModePicker: false,
                navigationHelpButton: false,
                animation: false,
                timeline: false,
                fullscreenButton: false,
                vrButton: false
            });

            // è®¾ç½®åˆå§‹è§†è§’ï¼ˆä»¥åŒ—äº¬ä¸ºä¾‹ï¼‰
            viewer.camera.setView({
                destination: Cesium.Cartesian3.fromDegrees(116.397, 39.909, 1000),
                orientation: {
                    heading: Cesium.Math.toRadians(0),
                    pitch: Cesium.Math.toRadians(-45),
                    roll: 0.0
                }
            });

            // æ·»åŠ ç®€å•çš„ 3D å»ºç­‘ï¼ˆç¨‹åºç”Ÿæˆï¼Œå…è´¹ï¼‰
            add3DBuildings();

            // æ·»åŠ ç¤ºä¾‹å»ºç­‘å’Œé“è·¯æ ‡ç­¾
            addSampleBuildings();
            addSampleRoads();
        }

        function add3DBuildings() {
            // ç¨‹åºç”Ÿæˆä¸€äº›ç®€å•çš„ 3D å»ºç­‘
            const buildings = [
                { position: [116.397, 39.909], height: 100, name: 'ç¤ºä¾‹å»ºç­‘1' },
                { position: [116.400, 39.912], height: 80, name: 'ç¤ºä¾‹å»ºç­‘2' },
                { position: [116.394, 39.906], height: 120, name: 'ç¤ºä¾‹å»ºç­‘3' },
                { position: [116.410, 39.915], height: 90, name: 'ç¤ºä¾‹å»ºç­‘4' }
            ];

            buildings.forEach(building => {
                viewer.entities.add({
                    position: Cesium.Cartesian3.fromDegrees(building.position[0], building.position[1]),
                    box: {
                        dimensions: new Cesium.Cartesian3(40.0, 40.0, building.height),
                        material: Cesium.Color.BLUE.withAlpha(0.7),
                        outline: true,
                        outlineColor: Cesium.Color.BLACK
                    }
                });
            });
        }

        function setupEventHandlers() {
            // åœ°å›¾ç‚¹å‡»äº‹ä»¶
            viewer.cesiumWidget.canvas.addEventListener('click', function(e) {
                if (isAddingMarker) {
                    handleMarkerClick(e);
                } else if (isDrawingRoute) {
                    handleRouteClick(e);
                }
            });

            // ç¦ç”¨é»˜è®¤çš„åŒå‡»è¡Œä¸º
            viewer.cesiumWidget.canvas.addEventListener('dblclick', function(e) {
                e.stopPropagation();
                if (isDrawingRoute) {
                    finishRoute();
                }
            });
        }

        function addMarker() {
            isAddingMarker = true;
            isDrawingRoute = false;
            updateInfoPanel('ç‚¹å‡»åœ°å›¾æ·»åŠ æ ‡è®°ç‚¹...');
            viewer.canvas.style.cursor = 'crosshair';
        }

        function drawRoute() {
            isDrawingRoute = true;
            isAddingMarker = false;
            currentRoute = [];
            updateInfoPanel('ç‚¹å‡»åœ°å›¾ç»˜åˆ¶è·¯çº¿ï¼ŒåŒå‡»ç»“æŸ...');
            viewer.canvas.style.cursor = 'crosshair';
        }

        function handleMarkerClick(click) {
            const pickedPosition = viewer.camera.pickEllipsoid(new Cesium.Cartesian2(click.offsetX, click.offsetY), viewer.scene.globe.ellipsoid);
            if (pickedPosition) {
                pendingMarkerPosition = pickedPosition;
                $('#markerDialog').dialog('open');
                isAddingMarker = false;
                viewer.canvas.style.cursor = 'default';
            }
        }

        function handleRouteClick(click) {
            const pickedPosition = viewer.camera.pickEllipsoid(new Cesium.Cartesian2(click.offsetX, click.offsetY), viewer.scene.globe.ellipsoid);
            if (pickedPosition) {
                currentRoute.push(pickedPosition);
                
                // æ·»åŠ è·¯å¾„ç‚¹æ ‡è®°
                viewer.entities.add({
                    position: pickedPosition,
                    point: {
                        pixelSize: 8,
                        color: Cesium.Color.YELLOW,
                        outlineColor: Cesium.Color.BLACK,
                        outlineWidth: 2
                    }
                });

                updateInfoPanel(`è·¯çº¿ç‚¹ ${currentRoute.length} å·²æ·»åŠ ï¼ŒåŒå‡»ç»“æŸç»˜åˆ¶`);
            }
        }

        function finishRoute() {
            if (currentRoute.length >= 2) {
                const routeEntity = viewer.entities.add({
                    polyline: {
                        positions: currentRoute,
                        width: 5,
                        material: Cesium.Color.CYAN,
                        clampToGround: true
                    }
                });

                routes.push({
                    entity: routeEntity,
                    points: currentRoute.length,
                    length: calculateRouteLength(currentRoute)
                });

                updateRoutesInfo();
            }

            isDrawingRoute = false;
            currentRoute = [];
            viewer.canvas.style.cursor = 'default';
            updateInfoPanel('è·¯çº¿ç»˜åˆ¶å®Œæˆ');
        }

        function saveMarker() {
            if (!pendingMarkerPosition) return;

            const formData = $('#markerForm').serializeArray();
            const markerData = {};
            formData.forEach(item => {
                markerData[item.name] = item.value;
            });

            // æ ¹æ®ç±»å‹é€‰æ‹©ä¸åŒçš„å›¾æ ‡é¢œè‰²
            let color = Cesium.Color.RED;
            switch (markerData.type) {
                case 'building': color = Cesium.Color.BLUE; break;
                case 'landmark': color = Cesium.Color.GREEN; break;
                case 'facility': color = Cesium.Color.ORANGE; break;
                default: color = Cesium.Color.RED;
            }

            const markerEntity = viewer.entities.add({
                position: pendingMarkerPosition,
                billboard: {
                    image: 'data:image/svg+xml;base64,' + btoa(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                            <circle cx="16" cy="16" r="12" fill="${color.toCssColorString()}" stroke="white" stroke-width="2"/>
                            <text x="16" y="20" text-anchor="middle" fill="white" font-size="14" font-weight="bold">â—</text>
                        </svg>
                    `),
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM
                },
                label: {
                    text: markerData.name,
                    font: '14pt sans-serif',
                    fillColor: Cesium.Color.WHITE,
                    outlineColor: Cesium.Color.BLACK,
                    outlineWidth: 2,
                    style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                    pixelOffset: new Cesium.Cartesian2(0, -50),
                    scaleByDistance: new Cesium.NearFarScalar(1.5e2, 1.0, 1.5e7, 0.5)
                }
            });

            markers.push({
                entity: markerEntity,
                data: markerData,
                position: pendingMarkerPosition
            });

            $('#markerDialog').dialog('close');
            $('#markerForm')[0].reset();
            pendingMarkerPosition = null;
            
            updateMarkersInfo();
            updateInfoPanel('æ ‡è®°æ·»åŠ æˆåŠŸ');
        }

        function toggleBuildings() {
            buildingsVisible = !buildingsVisible;
            
            // åˆ‡æ¢ç¨‹åºç”Ÿæˆçš„å»ºç­‘æ˜¾ç¤º
            viewer.entities.values.forEach(entity => {
                if (entity.box) {
                    entity.show = buildingsVisible;
                }
                // åˆ‡æ¢å»ºç­‘æ ‡ç­¾æ˜¾ç¤º
                if (entity.label && entity.label.text && entity.label.text.getValue().includes('å¤§å¦')) {
                    entity.show = buildingsVisible;
                }
            });
            
            updateInfoPanel(`å»ºç­‘æ˜¾ç¤º: ${buildingsVisible ? 'å¼€å¯' : 'å…³é—­'}`);
        }

        function toggleRoads() {
            roadsVisible = !roadsVisible;
            
            // åˆ‡æ¢é“è·¯æ ‡ç­¾æ˜¾ç¤º
            viewer.entities.values.forEach(entity => {
                if (entity.label && entity.label.text && (entity.label.text.getValue().includes('è·¯') || entity.label.text.getValue().includes('è¡—'))) {
                    entity.show = roadsVisible;
                }
            });
            
            updateInfoPanel(`é“è·¯æ˜¾ç¤º: ${roadsVisible ? 'å¼€å¯' : 'å…³é—­'}`);
        }

        function clearAll() {
            $.messager.confirm('ç¡®è®¤', 'ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ ‡è®°å’Œè·¯çº¿å—ï¼Ÿ', function(r) {
                if (r) {
                    // æ¸…é™¤ç”¨æˆ·æ·»åŠ çš„æ ‡è®°å’Œè·¯çº¿
                    markers.forEach(marker => viewer.entities.remove(marker.entity));
                    routes.forEach(route => viewer.entities.remove(route.entity));
                    
                    // æ¸…é™¤è·¯çº¿ç‚¹
                    viewer.entities.values.forEach(entity => {
                        if (entity.point && entity.point.color && entity.point.color.getValue().equals(Cesium.Color.YELLOW)) {
                            viewer.entities.remove(entity);
                        }
                    });
                    
                    markers = [];
                    routes = [];
                    currentRoute = [];
                    
                    updateInfoPanel('æ‰€æœ‰æ•°æ®å·²æ¸…é™¤');
                }
            });
        }

        function showHelp() {
            $('#helpDialog').dialog('open');
        }

        function addSampleBuildings() {
            // æ·»åŠ ç¤ºä¾‹å»ºç­‘æ ‡ç­¾
            const buildings = [
                { name: 'å›½è´¸å¤§å¦', position: [116.458, 39.918] },
                { name: 'ä¸­å¤®ç”µè§†å°', position: [116.325, 39.920] },
                { name: 'é¸Ÿå·¢ä½“è‚²åœº', position: [116.388, 39.993] },
                { name: 'æ°´ç«‹æ–¹', position: [116.385, 39.995] }
            ];

            buildings.forEach(building => {
                viewer.entities.add({
                    position: Cesium.Cartesian3.fromDegrees(building.position[0], building.position[1], 100),
                    label: {
                        text: building.name,
                        font: '12pt sans-serif',
                        fillColor: Cesium.Color.WHITE,
                        outlineColor: Cesium.Color.BLUE,
                        outlineWidth: 2,
                        style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                        backgroundColor: Cesium.Color.BLUE.withAlpha(0.8),
                        backgroundPadding: new Cesium.Cartesian2(7, 5),
                        scaleByDistance: new Cesium.NearFarScalar(1.5e2, 1.0, 1.5e7, 0.5)
                    }
                });
            });
        }

        function addSampleRoads() {
            // æ·»åŠ ç¤ºä¾‹é“è·¯æ ‡ç­¾
            const roads = [
                { name: 'é•¿å®‰è¡—', position: [116.397, 39.906] },
                { name: 'ç‹åºœäº•å¤§è¡—', position: [116.414, 39.909] },
                { name: 'è¥¿å•åŒ—å¤§è¡—', position: [116.380, 39.909] },
                { name: 'ä¸œé•¿å®‰è¡—', position: [116.420, 39.906] }
            ];

            roads.forEach(road => {
                viewer.entities.add({
                    position: Cesium.Cartesian3.fromDegrees(road.position[0], road.position[1], 50),
                    label: {
                        text: road.name,
                        font: '10pt sans-serif',
                        fillColor: Cesium.Color.WHITE,
                        outlineColor: Cesium.Color.GREEN,
                        outlineWidth: 1,
                        style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                        backgroundColor: Cesium.Color.GREEN.withAlpha(0.8),
                        backgroundPadding: new Cesium.Cartesian2(5, 3),
                        scaleByDistance: new Cesium.NearFarScalar(1.5e2, 1.0, 1.5e7, 0.3)
                    }
                });
            });
        }

        function calculateRouteLength(positions) {
            let totalLength = 0;
            for (let i = 1; i < positions.length; i++) {
                const distance = Cesium.Cartesian3.distance(positions[i-1], positions[i]);
                totalLength += distance;
            }
            return (totalLength / 1000).toFixed(2); // è½¬æ¢ä¸ºå…¬é‡Œ
        }

        function updateInfoPanel(message) {
            let content = `<p><strong>çŠ¶æ€:</strong> ${message}</p>`;
            content += `<p><strong>æ ‡è®°æ•°é‡:</strong> ${markers.length}</p>`;
            content += `<p><strong>è·¯çº¿æ•°é‡:</strong> ${routes.length}</p>`;
            content += `<p><strong>å»ºç­‘æ˜¾ç¤º:</strong> ${buildingsVisible ? 'å¼€å¯' : 'å…³é—­'}</p>`;
            content += `<p><strong>é“è·¯æ˜¾ç¤º:</strong> ${roadsVisible ? 'å¼€å¯' : 'å…³é—­'}</p>`;
            
            if (markers.length > 0) {
                content += '<h4>æ ‡è®°åˆ—è¡¨:</h4>';
                markers.forEach((marker, index) => {
                    content += `<div class="marker-info">
                        <strong>${marker.data.name}</strong><br>
                        ç±»å‹: ${marker.data.type}<br>
                        æè¿°: ${marker.data.description || 'æ— '}
                    </div>`;
                });
            }
            
            if (routes.length > 0) {
                content += '<h4>è·¯çº¿åˆ—è¡¨:</h4>';
                routes.forEach((route, index) => {
                    content += `<div class="route-info">
                        <strong>è·¯çº¿ ${index + 1}</strong><br>
                        ç‚¹æ•°: ${route.points}<br>
                        é•¿åº¦: ${route.length} å…¬é‡Œ
                    </div>`;
                });
            }
            
            $('#infoContent').html(content);
        }

        function updateMarkersInfo() {
            updateInfoPanel('æ ‡è®°ä¿¡æ¯å·²æ›´æ–°');
        }

        function updateRoutesInfo() {
            updateInfoPanel('è·¯çº¿ä¿¡æ¯å·²æ›´æ–°');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        $(window).resize(function() {
            if (viewer) {
                viewer.resize();
            }
        });
    </script>
</body>
</html> 