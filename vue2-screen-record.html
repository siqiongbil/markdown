<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue2ÂΩïÂ±è+Èü≥È¢ëËΩ¨Â≠óÂπïÁ≥ªÁªü</title>
    
    <!-- Vue2 + Element UI -->
    <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .control-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
        }
        
        .section-title {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }
        
        .video-container {
            width: 100%;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .video-container video {
            width: 100%;
            display: block;
        }
        
        .video-placeholder {
            height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 1.1em;
        }
        
        .status-card {
            margin-bottom: 20px;
        }
        
        .transcript-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
        }
        
        .transcript-content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            min-height: 300px;
            border: 1px solid #ddd;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            overflow-y: auto;
            max-height: 400px;
        }
        
        .settings-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .recording-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #f56c6c;
            border-radius: 50%;
            animation: pulse 1s infinite;
            margin-left: 10px;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .el-progress {
            margin: 15px 0;
        }
        
        @media (max-width: 768px) {
            .control-row {
                grid-template-columns: 1fr;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <h1>üìπ Vue2ÂΩïÂ±è+Èü≥È¢ëËΩ¨Â≠óÂπïÁ≥ªÁªü</h1>
                <p>Âü∫‰∫éVue2 + Element UIÁöÑ‰∏ì‰∏öÂΩïÂ±è‰∏éËØ≠Èü≥ËØÜÂà´Ëß£ÂÜ≥ÊñπÊ°à</p>
            </div>
            
            <div class="main-content">
                <!-- ËÆæÁΩÆÈù¢Êùø -->
                <div class="settings-panel">
                    <h2 class="section-title">‚öôÔ∏è ÂΩïÂà∂ËÆæÁΩÆ</h2>
                    <div class="settings-grid">
                        <el-select v-model="settings.videoQuality" placeholder="ÈÄâÊã©ËßÜÈ¢ëË¥®Èáè">
                            <el-option label="720p (Êé®Ëçê)" value="720p"></el-option>
                            <el-option label="1080p (È´òË¥®Èáè)" value="1080p"></el-option>
                            <el-option label="480p (ÊµÅÁïÖ)" value="480p"></el-option>
                        </el-select>
                        
                        <el-select v-model="settings.audioSource" placeholder="ÈÄâÊã©Èü≥È¢ëÊù•Ê∫ê">
                            <el-option label="Á≥ªÁªüÈü≥È¢ë" value="system"></el-option>
                            <el-option label="È∫¶ÂÖãÈ£é" value="microphone"></el-option>
                            <el-option label="Á≥ªÁªü+È∫¶ÂÖãÈ£é" value="both"></el-option>
                        </el-select>
                        
                        <el-select v-model="settings.language" placeholder="ËØÜÂà´ËØ≠Ë®Ä">
                            <el-option label="‰∏≠Êñá (ÁÆÄ‰Ωì)" value="zh-CN"></el-option>
                            <el-option label="English (US)" value="en-US"></el-option>
                            <el-option label="Êó•Êú¨Ë™û" value="ja-JP"></el-option>
                            <el-option label="ÌïúÍµ≠Ïñ¥" value="ko-KR"></el-option>
                        </el-select>
                        
                        <el-switch
                            v-model="settings.continuous"
                            active-text="ËøûÁª≠ËØÜÂà´">
                        </el-switch>
                    </div>
                </div>
                
                <!-- ÊéßÂà∂ÂíåÈ¢ÑËßàÈù¢Êùø -->
                <div class="control-row">
                    <!-- ÊéßÂà∂Èù¢Êùø -->
                    <div class="panel">
                        <h2 class="section-title">üéÆ ÊéßÂà∂Èù¢Êùø</h2>
                        
                        <el-alert
                            :title="statusMessage"
                            :type="statusType"
                            :closable="false"
                            class="status-card">
                            <span v-if="isRecording" class="recording-indicator"></span>
                        </el-alert>
                        
                        <div style="margin-bottom: 20px;">
                            <el-button
                                type="primary"
                                icon="el-icon-video-camera"
                                @click="startRecording"
                                :disabled="isRecording || !browserSupported">
                                ÂºÄÂßãÂΩïÂà∂
                            </el-button>
                            
                            <el-button
                                type="danger"
                                icon="el-icon-video-pause"
                                @click="stopRecording"
                                :disabled="!isRecording">
                                ÂÅúÊ≠¢ÂΩïÂà∂
                            </el-button>
                            
                            <el-button
                                type="success"
                                icon="el-icon-download"
                                @click="downloadVideo"
                                :disabled="!recordedVideo">
                                ‰∏ãËΩΩËßÜÈ¢ë
                            </el-button>
                            
                            <el-button
                                icon="el-icon-delete"
                                @click="clearTranscript">
                                Ê∏ÖÁ©∫Â≠óÂπï
                            </el-button>
                        </div>
                        
                        <el-progress
                            v-if="isRecording"
                            :percentage="recordingProgress"
                            :format="formatProgress">
                        </el-progress>
                        
                        <div v-if="recordingTime" style="color: #666; font-size: 14px;">
                            ÂΩïÂà∂Êó∂Èó¥: {{ recordingTime }}
                        </div>
                    </div>
                    
                    <!-- ËßÜÈ¢ëÈ¢ÑËßàÈù¢Êùø -->
                    <div class="panel">
                        <h2 class="section-title">üì∫ ËßÜÈ¢ëÈ¢ÑËßà</h2>
                        
                        <div class="video-container">
                            <video v-if="videoUrl" :src="videoUrl" controls></video>
                            <div v-else class="video-placeholder">
                                ÁÇπÂáª"ÂºÄÂßãÂΩïÂà∂"ÂºÄÂßãÂΩïÂ±è
                            </div>
                        </div>
                        
                        <el-card shadow="never">
                            <div slot="header">ÂΩïÂà∂‰ø°ÊÅØ</div>
                            <div>{{ recordingInfo }}</div>
                        </el-card>
                    </div>
                </div>
                
                <!-- Â≠óÂπïÈù¢Êùø -->
                <div class="transcript-panel">
                    <h2 class="section-title">üìù ÂÆûÊó∂Â≠óÂπï</h2>
                    
                    <div class="transcript-content">{{ transcriptText || 'Á≠âÂæÖËØ≠Èü≥ËæìÂÖ•...' }}</div>
                    
                    <div style="margin-top: 20px;">
                        <el-button
                            icon="el-icon-document"
                            @click="exportTranscript">
                            ÂØºÂá∫Â≠óÂπï
                        </el-button>
                        
                        <el-button
                            icon="el-icon-copy-document"
                            @click="copyTranscript">
                            Â§çÂà∂ÊñáÊú¨
                        </el-button>
                        
                        <el-button
                            icon="el-icon-folder"
                            @click="saveTranscript">
                            ‰øùÂ≠òÂ≠óÂπï
                        </el-button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data() {
                return {
                    // ÂΩïÂà∂Áõ∏ÂÖ≥
                    mediaRecorder: null,
                    recordedChunks: [],
                    stream: null,
                    recognition: null,
                    isRecording: false,
                    startTime: null,
                    videoUrl: '',
                    recordedVideo: false,
                    
                    // Â≠óÂπïÁõ∏ÂÖ≥
                    transcriptText: '',
                    
                    // Áä∂ÊÄÅÁõ∏ÂÖ≥
                    statusMessage: 'Á≥ªÁªüÂ∞±Áª™',
                    statusType: 'success',
                    recordingInfo: 'Á≠âÂæÖÂºÄÂßãÂΩïÂà∂...',
                    recordingTime: '',
                    recordingProgress: 0,
                    browserSupported: true,
                    
                    // ËÆæÁΩÆ
                    settings: {
                        videoQuality: '720p',
                        audioSource: 'system',
                        language: 'zh-CN',
                        continuous: true
                    },
                    
                    // ÂÆöÊó∂Âô®
                    timer: null
                }
            },
            
            mounted() {
                this.checkBrowserSupport();
                this.loadSavedTranscript();
            },
            
            beforeDestroy() {
                if (this.timer) {
                    clearInterval(this.timer);
                }
                if (this.isRecording) {
                    this.stopRecording();
                }
            },
            
            methods: {
                // Ê£ÄÊü•ÊµèËßàÂô®ÊîØÊåÅ
                checkBrowserSupport() {
                    if (!navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia) {
                        this.browserSupported = false;
                        this.statusMessage = 'ÊµèËßàÂô®‰∏çÊîØÊåÅÂ±èÂπïÂΩïÂà∂ÂäüËÉΩ';
                        this.statusType = 'error';
                        this.$message.error('ÊµèËßàÂô®‰∏çÊîØÊåÅÂ±èÂπïÂΩïÂà∂ÂäüËÉΩ');
                    }
                },
                
                // ÂàùÂßãÂåñËØ≠Èü≥ËØÜÂà´
                initSpeechRecognition() {
                    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                        this.recognition = new SpeechRecognition();
                        
                        this.recognition.lang = this.settings.language;
                        this.recognition.continuous = this.settings.continuous;
                        this.recognition.interimResults = true;
                        this.recognition.maxAlternatives = 1;

                        this.recognition.onstart = () => {
                            console.log('üé§ ËØ≠Èü≥ËØÜÂà´Â∑≤ÂºÄÂßã');
                        };

                        this.recognition.onresult = (event) => {
                            let finalTranscript = '';

                            for (let i = event.resultIndex; i < event.results.length; i++) {
                                const transcript = event.results[i][0].transcript;
                                if (event.results[i].isFinal) {
                                    finalTranscript += transcript;
                                }
                            }

                            if (finalTranscript) {
                                const timestamp = this.getTimestamp();
                                const line = `[${timestamp}] ${finalTranscript}\n`;
                                this.transcriptText += line;
                            }
                        };

                        this.recognition.onerror = (event) => {
                            console.error('ËØ≠Èü≥ËØÜÂà´ÈîôËØØ:', event.error);
                            this.$message.error('ËØ≠Èü≥ËØÜÂà´ÈîôËØØ: ' + event.error);
                        };

                        this.recognition.onend = () => {
                            if (this.isRecording) {
                                setTimeout(() => {
                                    if (this.isRecording) {
                                        this.recognition.start();
                                    }
                                }, 100);
                            }
                        };

                        return true;
                    } else {
                        this.$message.error('ÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ËØÜÂà´ÂäüËÉΩ');
                        return false;
                    }
                },
                
                // ÂºÄÂßãÂΩïÂà∂
                async startRecording() {
                    try {
                        const displayStream = await navigator.mediaDevices.getDisplayMedia({
                            video: this.getVideoConstraints(),
                            audio: true
                        });

                        let audioStream = null;
                        if (this.settings.audioSource === 'microphone' || this.settings.audioSource === 'both') {
                            try {
                                audioStream = await navigator.mediaDevices.getUserMedia({
                                    audio: true
                                });
                            } catch (err) {
                                console.warn('Êó†Ê≥ïËé∑ÂèñÈ∫¶ÂÖãÈ£éÊùÉÈôê:', err);
                                this.$message.warning('Êó†Ê≥ïËé∑ÂèñÈ∫¶ÂÖãÈ£éÊùÉÈôê');
                            }
                        }

                        this.stream = displayStream;

                        this.recordedChunks = [];
                        this.mediaRecorder = new MediaRecorder(this.stream, {
                            mimeType: 'video/webm;codecs=vp9'
                        });

                        this.mediaRecorder.ondataavailable = (event) => {
                            if (event.data.size > 0) {
                                this.recordedChunks.push(event.data);
                            }
                        };

                        this.mediaRecorder.onstop = () => {
                            const blob = new Blob(this.recordedChunks, { type: 'video/webm' });
                            this.videoUrl = URL.createObjectURL(blob);
                            this.recordedVideo = true;
                            
                            this.statusMessage = 'ÂΩïÂà∂ÂÆåÊàêÔºåÂèØ‰ª•‰∏ãËΩΩËßÜÈ¢ë';
                            this.statusType = 'success';
                            this.$message.success('ÂΩïÂà∂ÂÆåÊàê');
                        };

                        this.mediaRecorder.start(1000);
                        this.isRecording = true;
                        this.startTime = Date.now();

                        if (this.initSpeechRecognition()) {
                            this.recognition.start();
                        }

                        this.statusMessage = 'Ê≠£Âú®ÂΩïÂà∂‰∏≠...';
                        this.statusType = 'warning';
                        this.recordingInfo = 'ÂΩïÂà∂ËøõË°å‰∏≠...';
                        this.startTimer();

                        this.stream.getVideoTracks()[0].onended = () => {
                            this.stopRecording();
                        };

                        this.$message.success('ÂΩïÂà∂ÂºÄÂßã');

                    } catch (err) {
                        console.error('ÂºÄÂßãÂΩïÂà∂Â§±Ë¥•:', err);
                        this.$message.error('ÂºÄÂßãÂΩïÂà∂Â§±Ë¥•: ' + err.message);
                        this.statusMessage = 'ÂΩïÂà∂Â§±Ë¥•: ' + err.message;
                        this.statusType = 'error';
                    }
                },
                
                // ÂÅúÊ≠¢ÂΩïÂà∂
                stopRecording() {
                    if (this.mediaRecorder && this.isRecording) {
                        this.mediaRecorder.stop();
                        this.isRecording = false;

                        if (this.recognition) {
                            this.recognition.stop();
                        }

                        if (this.stream) {
                            this.stream.getTracks().forEach(track => track.stop());
                        }

                        if (this.timer) {
                            clearInterval(this.timer);
                        }

                        this.statusMessage = 'ÂΩïÂà∂Â∑≤ÂÅúÊ≠¢';
                        this.statusType = 'info';
                        this.recordingInfo = 'ÂΩïÂà∂Â∑≤ÂÆåÊàê';
                        this.recordingProgress = 0;
                        
                        this.$message.info('ÂΩïÂà∂Â∑≤ÂÅúÊ≠¢');
                    }
                },
                
                // ‰∏ãËΩΩËßÜÈ¢ë
                downloadVideo() {
                    if (this.recordedChunks.length > 0) {
                        const blob = new Blob(this.recordedChunks, { type: 'video/webm' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `vue2-screen-recording-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.webm`;
                        a.click();
                        URL.revokeObjectURL(url);
                        
                        this.$message.success('ËßÜÈ¢ë‰∏ãËΩΩÂºÄÂßã');
                    }
                },
                
                // Ëé∑ÂèñËßÜÈ¢ëÁ∫¶Êùü
                getVideoConstraints() {
                    const constraints = {
                        1080p: { width: 1920, height: 1080, frameRate: 30 },
                        720p: { width: 1280, height: 720, frameRate: 30 },
                        480p: { width: 854, height: 480, frameRate: 24 }
                    };
                    
                    return constraints[this.settings.videoQuality];
                },
                
                // Ëé∑ÂèñÊó∂Èó¥Êà≥
                getTimestamp() {
                    if (!this.startTime) return '00:00:00';
                    
                    const elapsed = Date.now() - this.startTime;
                    const hours = Math.floor(elapsed / 3600000);
                    const minutes = Math.floor((elapsed % 3600000) / 60000);
                    const seconds = Math.floor((elapsed % 60000) / 1000);
                    
                    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                },
                
                // ÂºÄÂßãËÆ°Êó∂Âô®
                startTimer() {
                    this.timer = setInterval(() => {
                        if (!this.isRecording) {
                            clearInterval(this.timer);
                            return;
                        }
                        
                        const elapsed = Date.now() - this.startTime;
                        const minutes = Math.floor(elapsed / 60000);
                        const seconds = Math.floor((elapsed % 60000) / 1000);
                        
                        this.recordingTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        
                        const maxTime = 30 * 60 * 1000;
                        this.recordingProgress = Math.min((elapsed / maxTime) * 100, 100);
                    }, 1000);
                },
                
                // Ê†ºÂºèÂåñËøõÂ∫¶
                formatProgress(percentage) {
                    return percentage === 100 ? 'ÂΩïÂà∂Âç≥Â∞ÜÁªìÊùü' : `${percentage.toFixed(1)}%`;
                },
                
                // Ê∏ÖÁ©∫Â≠óÂπï
                clearTranscript() {
                    this.transcriptText = '';
                    this.$message.success('Â≠óÂπïÂ∑≤Ê∏ÖÁ©∫');
                },
                
                // ÂØºÂá∫Â≠óÂπï
                exportTranscript() {
                    if (!this.transcriptText) {
                        this.$message.warning('Ê≤°ÊúâÂ≠óÂπïÂÜÖÂÆπÂèØÂØºÂá∫');
                        return;
                    }
                    
                    const blob = new Blob([this.transcriptText], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `vue2-transcript-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    this.$message.success('Â≠óÂπïÂØºÂá∫ÊàêÂäü');
                },
                
                // Â§çÂà∂Â≠óÂπï
                copyTranscript() {
                    if (!this.transcriptText) {
                        this.$message.warning('Ê≤°ÊúâÂ≠óÂπïÂÜÖÂÆπÂèØÂ§çÂà∂');
                        return;
                    }
                    
                    navigator.clipboard.writeText(this.transcriptText).then(() => {
                        this.$message.success('Â≠óÂπïÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
                    }).catch(err => {
                        console.error('Â§çÂà∂Â§±Ë¥•:', err);
                        this.$message.error('Â§çÂà∂Â§±Ë¥•');
                    });
                },
                
                // ‰øùÂ≠òÂ≠óÂπï
                saveTranscript() {
                    if (!this.transcriptText) {
                        this.$message.warning('Ê≤°ÊúâÂ≠óÂπïÂÜÖÂÆπÂèØ‰øùÂ≠ò');
                        return;
                    }
                    
                    localStorage.setItem('vue2SavedTranscript', this.transcriptText);
                    localStorage.setItem('vue2SavedTranscriptTime', new Date().toISOString());
                    this.$message.success('Â≠óÂπïÂ∑≤‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®');
                },
                
                // Âä†ËΩΩ‰øùÂ≠òÁöÑÂ≠óÂπï
                loadSavedTranscript() {
                    const savedTranscript = localStorage.getItem('vue2SavedTranscript');
                    if (savedTranscript) {
                        const savedTime = localStorage.getItem('vue2SavedTranscriptTime');
                        this.$confirm(`ÂèëÁé∞‰øùÂ≠òÁöÑÂ≠óÂπïÂÜÖÂÆπ (${new Date(savedTime).toLocaleString()})ÔºåÊòØÂê¶ÊÅ¢Â§çÔºü`, 'ÊèêÁ§∫', {
                            confirmButtonText: 'ÊÅ¢Â§ç',
                            cancelButtonText: 'ÂèñÊ∂à',
                            type: 'info'
                        }).then(() => {
                            this.transcriptText = savedTranscript;
                            this.$message.success('Â≠óÂπïÂÜÖÂÆπÂ∑≤ÊÅ¢Â§ç');
                        }).catch(() => {
                            // Áî®Êà∑ÂèñÊ∂à
                        });
                    }
                }
            },
            
            watch: {
                'settings.language'(newVal) {
                    if (this.recognition) {
                        this.recognition.lang = newVal;
                    }
                },
                
                'settings.continuous'(newVal) {
                    if (this.recognition) {
                        this.recognition.continuous = newVal;
                    }
                }
            }
        });
    </script>
</body>
</html>
